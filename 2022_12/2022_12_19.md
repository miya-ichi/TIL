# 2022年12月19日

## 環境変数とdotenv・cledentialsについて
自作アプリでAPIなどを使う際に、APIキー、アクセスキーなどといった外部に公開すべきではないが、アプリケーションに読み込ませたい情報というものが出てくる。  
それを何も考慮せずにいると
1. プログラム内に直接APIキーを記述
2. それをGithubなどの外部からアクセス可能な環境にアップロード
3. APIキーを第三者に悪用され、高額の使用料請求がきてしまう

こういうパターンで困ってしまうかもしれない  

対策として、APIキーなどの情報は直接プログラムに記述せず、環境変数に設定する、RailsにおいてはCredentialsという機能を使用するという手段がある。

### 環境変数
環境（マシンやプログラムの実行環境）ごとに用意する変数のことで、各々の環境ごとに各自で設定を行う。

### dotenv
参考
https://pikawaka.com/rails/dotenv-rails

Rubyのプログラム内で使用する環境変数を管理できるGem。  
`.env`というファイルを用意し、その中に環境変数を記述することで、  それをプログラム内から読み込むようにする。  
`.envファイルはGitの管理対象から除外し(.gitignore)、雛形のファイルをGithubで共有するなどで利用しやすくする`
開発環境やテスト環境など、環境別に変数を管理したい場合は、.env.環境名のファイルを設置する。複数の.envファイルが設置されている場合、優先順位に従って環境変数が適用される

Rubyでdotenvを使用する方法はこちらも
https://morizyun.github.io/ruby/library-dotenv.html

RailsではないRubyで使用する場合は、rbファイル内で`require 'dotenv`を記述したのち、`Dotenv.load`で.envファイルに記述した環境変数を読み込む必要があるようだ。

### credentials
参考
https://hirocorpblog.com/rails-credentials-master/

Railsにおいて、production環境用の秘密情報を管理するためのファイル、またそのシステムのこと。  
`credentials.yml.enc`というファイルにAPIキーなどの情報を暗号化して保存しているので、Github等にアップロードして共有することが可能となっている。  
複合のために`master.key`というファイルがあり、これを外部に漏洩しないよう保管する必要がある。  
credentialsの編集はRailsのコマンドを使って行う必要がある
